## 6.7 Zookeeper

### 稳定版本
当前稳定分支为`3.5`。`Kafka`会定期更新，以包括`3.5`系列的最新版本。

### ZooKeeper的运营
在操作上，我们为确保`ZooKeeper`的正常安装执行以下操作：

- 物理/硬件/网络布局中的冗余：尽量不要将它们放在相同的机架中，不要像样的（但不要发疯）硬件，尝试保持冗余的电源和网络路径，等等。典型的ZooKeeper集成有5个或5个。 7台服务器，分别允许2台和3台服务器停机。如果部署规模较小，则可以使用3台服务器，但是请记住，在这种情况下，您只能允许1台服务器停机。
- `I/O`隔离：如果您进行大量写类型的通信，则几乎肯定会希望事务记录在专用磁盘组上。对事务日志的写入是同步的（但为了提高性能而分批处理），因此，并发写入会严重影响性能。ZooKeeper快照可以是并发写入的一种来源，理想情况下应将其写入与事务日志分开的磁盘组中。快照是异步写入磁盘的，因此通常可以与操作系统和消息日志文件共享。您可以将服务器配置为使用带有`dataLogDir`参数的单独的磁盘组。
- 应用程序隔离：除非您真的了解要在同一盒中安装的其他应用程序的应用程序模式，否则最好单独运行ZooKeeper（尽管这可能与硬件功能保持平衡）。
- 小心使用虚拟化：它可以工作，具体取决于您的集群布局以及读/写模式和SLA，但是虚拟化层引入的微小开销可能会增加和放弃ZooKeeper，因为它对时间非常敏感
- ZooKeeper配置：它是Java，请确保为其提供“足够的”堆空间（我们通常使用3-5G运行它们，但这主要是由于此处的数据集大小）。不幸的是，我们没有一个好的公式，但是请记住，允许更多的ZooKeeper状态意味着快照会变大，而大快照会影响恢复时间。实际上，如果快照变得太大（几GB），那么您可能需要增加initLimit参数，以便有足够的时间让服务器恢复并加入集合。
- 监视：JMX和4个字母的单词（4lw）命令都非常有用，在某些情况下它们确实会重叠（在这种情况下，我们更喜欢4字母的命令，它们看起来更可预测，或者至少可以更好地与LI监控基础架构）
- 不要过度构建集群：大型集群，尤其是在写入密集型使用模式下，意味着大量集群内部通信（写仲裁和后续集群成员更新的数量），但不要过度构建集群（并且有可能淹没集群）。拥有更多服务器将增加您的读取容量。

总体而言，我们试图将`ZooKeeper`系统保持尽可能小以使其能够处理负载（加上标准的增长容量计划）并尽可能地简化。与正式发行版相比，我们尽量不要对配置或应用程序布局做任何花哨的事情，并使其尽可能独立。由于这些原因，我们倾向于跳过OS打包的版本，因为它倾向于尝试将事情放到OS标准层次结构中（可能是“混乱”），以寻求更好的措辞。